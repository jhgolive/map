<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>내 위치 지도</title>
  <script type="module">
    // Firebase 초기화
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDrfAe9sywKnV-MjG7T96Pe-p8SUsP2lrw",
      authDomain: "mygps-f1b26.firebaseapp.com",
      projectId: "mygps-f1b26",
      storageBucket: "mygps-f1b26.firebasestorage.app",
      messagingSenderId: "150465544045",
      appId: "1:150465544045:web:dd657c5c05f0d337756464"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 위치 가져와서 지도 표시 및 Firebase 저장
    function initMap(lat, lng) {
      const mapContainer = document.getElementById('map');
      const mapOption = {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
      };
      const map = new kakao.maps.Map(mapContainer, mapOption);

      const marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng)
      });
      marker.setMap(map);
    }

    async function getLocationAndSave() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;

          // 지도 표시
          initMap(lat, lng);

          // Firebase에 위치 저장
          try {
            await addDoc(collection(db, "locations"), {
              latitude: lat,
              longitude: lng,
              timestamp: new Date()
            });
            console.log("위치 저장 완료");
          } catch (e) {
            console.error("위치 저장 오류:", e);
          }
        }, (error) => {
          console.error("위치 가져오기 실패:", error);
          alert("위치 가져오기를 허용해 주세요.");
        });
      } else {
        alert("GPS를 지원하지 않는 기기입니다.");
      }
    }

    window.onload = getLocationAndSave;
  </script>

  <!-- 카카오맵 API -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=472f378af49957df6636a87b97fb6fd6"></script>
  <style>
    #map { width: 100%; height: 400px; }
  </style>
</head>
<body>
  <h2>내 위치 지도</h2>
  <div id="map"></div>
</body>
</html>
